function IS_OPERATOR(char){return char==SYMBOL_AND||char==SYMBOL_OR||char==SYMBOL_IMPL||char==SYMBOL_EQUAL}function IS_ALLOWEDCHAR_AROUND_CLIP(char){return IS_OPERATOR(char)||"("==char||")"==char}function DEBUG_NODE(node){console.log("===DEBUG_NODE==="),null==node?console.log("NODE IS NULL"):(console.log(node),console.log("isLeaf: "+node.isLeaf()),console.log("isRoot: "+node.isRoot()),console.log("isGroup: "+node.isGroup()),console.log("value: "+node.value),console.log("getHtml: "+node.getHtml())),console.log("==================")}const SYMBOL_OR="∨",SYMBOL_AND="∧",SYMBOL_NEG="¬",SYMBOL_IMPL="⇒",SYMBOL_EQUAL="⇔",DN_NR=["₀","₁","₂","₃","₄","₅","₆","₇","₈","₉"],UP_NR=["⁰","¹","²","³","⁴","⁵","⁶","⁷","⁸","⁹"],KEY_LEFT=37,KEY_RIGHT=39,KEY_UP=38,KEY_DOWN=40,KEY_BACKSPACE=8,KEY_SPACE=32,KEY_A=65,KEY_G=71,KEY_K=75,KEY_Z=90,KEY_NUM_0=96,KEY_NUM_1=97,KEY_0=48,KEY_1=49,KEY_2=50,KEY_3=51,KEY_4=52,KEY_5=53,KEY_6=54,KEY_7=55,KEY_8=56,KEY_9=57,KEY_DOT=190,KEY_COMMA=188,KEY_CONTROL=17;DomUtils={getCaretPosition:function(editableDiv){var sel,range,caretPos=0;if(window.getSelection)sel=window.getSelection(),sel.rangeCount&&(range=sel.getRangeAt(0),range.commonAncestorContainer.parentNode==editableDiv&&(caretPos=range.endOffset));else if(document.selection&&document.selection.createRange&&(range=document.selection.createRange(),range.parentElement()==editableDiv)){var tempEl=document.createElement("span");editableDiv.insertBefore(tempEl,editableDiv.firstChild);var tempRange=range.duplicate();tempRange.moveToElementText(tempEl),tempRange.setEndPoint("EndToEnd",range),caretPos=tempRange.text.length}return caretPos},insertTextAtCursor:function(text){var sel,range;window.getSelection?(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount&&(range=sel.getRangeAt(0),range.deleteContents(),range.insertNode(document.createTextNode(text)),range.endOffset++)):document.selection&&document.selection.createRange&&(document.selection.createRange().text=text)},pasteHtmlAtCaret:function(html,node){var sel,range;if(window.getSelection){if(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount){if(range=sel.getRangeAt(0),node&&(range.startContainer.id!=node.id||range.endContainer.id!=node.id||range.startContainer.className!=node.className||range.endContainer.className!=node.className))return console.log(node),console.log(range),!1;range.deleteContents();var el=document.createElement("div");el.innerHTML=html;for(var node,lastNode,frag=document.createDocumentFragment();node=el.firstChild;)lastNode=frag.appendChild(node);if(lastNode==node)return;range.insertNode(frag),lastNode&&(range=range.cloneRange(),range.setStartAfter(lastNode),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(html)},saveSelection:function(){if(window.getSelection){var sel=window.getSelection();if(sel.getRangeAt&&sel.rangeCount)return sel.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restoreSelection:function(range){if(range)if(window.getSelection){var sel=window.getSelection();sel.removeAllRanges(),sel.addRange(range)}else document.selection&&range.select&&range.select()},getSelectionStart:function(){var node=document.getSelection().getStartElement();return node},getCaretCharacterOffsetWithin:function(element){var sel,caretOffset=0,doc=element.ownerDocument||element.document,win=doc.defaultView||doc.parentWindow;if("undefined"!=typeof win.getSelection){if(sel=win.getSelection(),sel.rangeCount>0){var range=win.getSelection().getRangeAt(0),preCaretRange=range.cloneRange();preCaretRange.selectNodeContents(element),preCaretRange.setEnd(range.endContainer,range.endOffset),caretOffset=preCaretRange.toString().length}}else if((sel=doc.selection)&&"Control"!=sel.type){var textRange=sel.createRange(),preCaretTextRange=doc.body.createTextRange();preCaretTextRange.moveToElementText(element),preCaretTextRange.setEndPoint("EndToEnd",textRange),caretOffset=preCaretTextRange.text.length}return caretOffset},_setCaretPosition:function(element,offset){var range=document.createRange(),sel=window.getSelection(),currentNode=null,visitNode=function(node){console.log(node);for(var i=0;i<node.childNodes.length;i++)currentNode=element.childNodes[i],currentNode.childNodes.length>0,console.log(currentNode.nodeValue)};if(visitNode(element),null!=currentNode){currentNode.length<offset&&offset--;try{return range.setStart(currentNode,offset),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range),!0}catch(e){console.log(e)}}return!1},setCaretPosition:function(element,offset){for(var range=document.createRange(),sel=window.getSelection(),currentNode=null,previousNode=null,i=0;i<element.childNodes.length;i++){for(previousNode=currentNode,currentNode=element.childNodes[i];currentNode.childNodes.length>0;)currentNode=currentNode.childNodes[0];if(currentNode&&console.log(currentNode.nodeValue),null!=previousNode&&(offset-=previousNode.length),offset<=currentNode.length)break}return null!=currentNode&&(currentNode.length<offset&&offset--,range.setStart(currentNode,offset),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range),!0)},getSelectedText:function(withHtml){var html="";if("undefined"!=typeof window.getSelection){var sel=window.getSelection();if(sel.rangeCount){for(var container=document.createElement("div"),i=0,len=sel.rangeCount;i<len;++i)container.appendChild(sel.getRangeAt(i).cloneContents());html=withHtml?container.innerHTML:container.innerText}}else"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(html=withHtml?document.selection.createRange().htmlText:document.selection.createRange().text);return html}},String.prototype.replaceAll=function(search,replacement){var target=this;return target.split(search).join(replacement)};var BADomain=function(name){this.table=null,this.expression=null,this.groups=null,this.getTree=function(){return this.expression.rootNode}},BAGroup=function(text){this.expression=new BAExpression(text),this.expression.rootNode.group=this,this.key=BAGroup.getNextGroupIndex(text),this.number=BAGroup.groupIndex-1,this.isValid=function(){return this.expression.isValid()},this.getHtml=function(){return this.expression.getHtml()},this.getText=function(){return this.expression.text}};BAGroup.groups=[],BAGroup.groupIndex=1,BAGroup.getNextGroupIndex=function(text){for(var i=0;i<BAGroup.groups.length;i++){var group=BAGroup.groups[i];if(group.text==text)return group.key}return"G"+BAGroup.groupIndex++},BAGroup.get=function(key){var vKey=key.replace(SYMBOL_NEG,"");if(vKey.length<2)return null;for(var i=0;i<BAGroup.groups.length;i++){var group=BAGroup.groups[i];if(vKey==group.key)return group}return null},BAGroup.add=function(group){BAGroup.groups.push(group)},BAGroup.useGroup=function(mainExpr,group){mainExpr.useGroup(group);for(var i=0;i<BAGroup.groups.length;i++){var g=BAGroup.groups[i];g.key!=group.key&&g.expression.useGroup(group)}};var BANode=function(params){this.value=params?params.value:null,this.child1=params?params.child1:null,this.child2=params?params.child2:null,this.parent=params?params.parent:null,this.isClips=!!params&&params.isClips,this.parent=null,this.group=params?params.group:null,this.isNegative=!1,this.value.charAt(0)==SYMBOL_NEG&&(this.value=this.value.substr(1),this.isNegative=!0),this.isValid=function(){return this.child1&&this.child2},this.isRoot=function(){return null==this.parent},this.findChild=function(value){if(this.value==value)return this;var child=this.child1?this.child1.findChild(value):null;return null!=child?child:child=this.child2?this.child2.findChild(value):null},this.getValue=function(){return this.isNegative?SYMBOL_NEG+this.value:this.value},this.getHtml=function(){var value=this.getValue();if(this.isLeaf())value='<span class="expr">'+value+"</span>";else if(!this.isRoot()&&this.isGroup()||this.isRoot()&&this.isGroup()&&!this.child1&&!this.child2)value='<span class="expr group"><span>G</span><sub>'+this.group.number+"</sub></span>";else{var childA=this.child1&&""!=this.child1.value?this.child1.getHtml():"",childB=this.child2&&""!=this.child2.value?this.child2.getHtml():"",Class=IS_OPERATOR(value)?"op":"expr";value=childA+'<span class="'+Class+'">'+value+"</span>"+childB}return this.isClips?'<span class="expr"><span class="clips">(</span>'+value+'<span class="clips">)</span></span>':value},this.isGroup=function(){return null!=this.group},this.isLeaf=function(){return!(this.isGroup()||this.child1&&null!=this.child1&&this.child2&&null!=this.child2)},this.negResult=function(param){var result=this.getResult(param);return result?0:1},this.getResult=function(param){var result=0;if(!this.isGroup()||this.child1||this.child2)if(IS_OPERATOR(this.value)){var childA=this.child1.getResult(param),childB=this.child2.getResult(param);switch(this.value){case SYMBOL_AND:result=1==childA&&1==childB;break;case SYMBOL_OR:result=1==childA||1==childB;break;case SYMBOL_IMPL:childA=childA?0:1,result=1==childA||1==childB;break;case SYMBOL_EQUAL:result=childA==childB}}else for(var key in param)param.hasOwnProperty(key)&&key==this.value&&(result=Number(param[key]));else result=this.group.expression.rootNode.getResult(param);return this.isNegative&&(result=result?0:1),result=result?1:0}},BATable=function(rootNode){var letters=[],groups=[],loadGroups=function(){for(var i=0;i<BAGroup.groups.length;i++){var g=BAGroup.groups[i];groups.push(g.key)}},searchLetter=function(node){return!!node&&void(!node.isGroup()||node.child1||node.child2?node.isLeaf()?letters.indexOf(node.value)<0&&letters.push(node.value):(searchLetter(node.child1),searchLetter(node.child2)):searchLetter(node.group.expression.rootNode))};loadGroups(),searchLetter(rootNode),this.getTheadData=function(){return{groups:groups,letters:letters}}},BAExpression=function(text){text=text.replaceAll(" ","");this.rootNode=null,this.text="",this.errors=[];var clipStack,kNumber=1,priorSplit=[SYMBOL_EQUAL,SYMBOL_IMPL,SYMBOL_OR,SYMBOL_AND],getClips=function(text){for(var match,clip,startIndex=0,count=0,clips=[],re=BAExpression.regex.clips;null!==(match=re.exec(text));){if(count++>=99999)return console.log("MATCH ERROR"),!1;if(kNumber>=99999)return console.log("KNUMBER ERROR"),!1;var m=match[0];clip={key:"K"+kNumber++,raw:m,start:match.index,end:re.lastIndex-1},clip.text=clip.raw.substr(1,clip.raw.length-2),clips.push(clip),startIndex+=re.lastIndex}var output=text;if(clips.length>0){var i;for(i=0;i<clips.length;i++)clip=clips[i],output=output.replace(clip.raw,clip.key);var subClips=getClips(output);for(output=subClips.output,i=0;i<subClips.clips.length;i++)clips.push(subClips.clips[i])}return{input:text,output:output,clips:clips}},splitByOperator=function(text){for(var i=0;i<priorSplit.length;i++){var pS=priorSplit[i],index=text.indexOf(pS);if(index>-1){var sideA=text.substring(0,index),sideB=text.substring(index+1,text.length);return{a:sideA,b:sideB,value:pS}}}return{a:null,b:null,value:text}},getClip=function(key){var vKey=key.replace(SYMBOL_NEG,"");if(vKey.length<2)return null;for(var i=0;i<clipStack.length;i++){var clip=clipStack[i];if(clip.key==vKey)return clip}return null};this.buildTree=function(text){if(null==text)return null;var clip=getClip(text);clip&&(text=clip.text);var group=BAGroup.get(text),splitInfo=splitByOperator(text);splitInfo.length<=1&&console.log(text);var node=new BANode({value:splitInfo.value,isClips:!!clip,child1:this.buildTree(splitInfo.a),child2:this.buildTree(splitInfo.b),group:group});return node.child1&&(node.child1.parent=node),node.child2&&(node.child2.parent=node),node},this.findChild=function(value){return this.rootNode.findChild(value)},this.parse=function(text){text=text.toUpperCase(),this.text=text;var clips=getClips(text);clipStack=clips.clips,this.errors.length>0&&(console.log("=====ERROR===="),console.log(this.errors),console.log("==============")),this.rootNode=this.buildTree(clips.output)},text&&this.parse(text),this.isValid=function(){return 0==this.text.length||0==this.errors.length&&null!=this.rootNode},this.getText=function(){return this.text},this.getHtml=function(){return this.rootNode?this.rootNode.getHtml():""},this.groupFilter=function(group){return this.text.replaceAll(group.getText(),group.key)},this.getResult=function(param){return this.rootNode.getResult(param)},this.useGroup=function(group){var text=this.groupFilter(group);return text!=this.text&&(this.parse(text),this.updateInput(),!0)},this.unuseGroup=function(group){var text=this.text.replaceAll(group.key,group.getText());return text!=this.text&&(this.parse(text),this.updateInput(),!0)},this.updateInput=function(){this.$input&&this.$input.html(this.getHtml())},this.useAllGroups=function(){if(this.rootNode.isGroup())return!1;for(var i=0;i<BAGroup.groups.length;i++){var g=BAGroup.groups[i];BAGroup.useGroup(this,g)}}};BAExpression.regex={clips:/(\([0|1|A-Z0-9|∨|∧|¬|⇒]*\))/g,clipname:/K[1-9]*/g,syntax:/(¬*([((A-Za-z)(1-9)*)|1|0])(∧|∨)?)*/g},BAExpression.validSyntax=function(text){var forbChar=function(char){return char==SYMBOL_AND||char==SYMBOL_OR||char==SYMBOL_IMPL||char>="1"&&char<="9"};return!(forbChar(text.charAt(0))||forbChar(text.charAt(text.length-1)))},angular.module("boolean-algebra",["ngRoute","pascalprecht.translate","ngSanitize"]).config(function($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"/view/boolalg.html",controller:"BACtrl"}),$routeProvider.otherwise({redirectTo:"/"}),$locationProvider.html5Mode(!0)}).config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"translations/lang-",suffix:".json"}),$translateProvider.useSanitizeValueStrategy("escape"),$translateProvider.preferredLanguage("de_DE")}]);