function IS_OPERATOR(char){return char==SYMBOL_AND||char==SYMBOL_OR||char==SYMBOL_IMPL||char==SYMBOL_EQUAL||char==SYMBOL_NEG}function HAS_OPERATOR(text){for(var i=0;i<text.length;i++){var char=text.charAt(i);if(IS_OPERATOR(char))return!0}return!1}function DEBUG_NODE(node){null!=node&&(console.log("====DEBUG: "+node.value+"========"),console.log(node),console.log("isLeaf: "+node.isLeaf()),console.log("isGroup: "+node.isGroup()),console.log("isClips: "+node.isClips()),console.log("====END DEBUG============="))}function REX(re,text){var match=re.exec(text);console.log(match)}const SYMBOL_OR="∨",SYMBOL_AND="∧",SYMBOL_NEG="¬",SYMBOL_IMPL="⇒",SYMBOL_EQUAL="⇔",DN_NR=["₀","₁","₂","₃","₄","₅","₆","₇","₈","₉"],DNR={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉"},UP_NR=["⁰","¹","²","³","⁴","⁵","⁶","⁷","⁸","⁹"],KEY_LEFT=37,KEY_RIGHT=39,KEY_UP=38,KEY_DOWN=40,KEY_BACKSPACE=8,KEY_SPACE=32,KEY_A=65,KEY_G=71,KEY_K=75,KEY_Z=90,KEY_NUM_0=96,KEY_NUM_1=97,KEY_0=48,KEY_1=49,KEY_2=50,KEY_3=51,KEY_4=52,KEY_5=53,KEY_6=54,KEY_7=55,KEY_8=56,KEY_9=57,KEY_PLUS=187,KEY_COMMA=188,KEY_LINE=189,KEY_DOT=190,KEY_SHARP=191,KEY_CONTROL=17;DomUtils={getCaretPosition:function(editableDiv){var sel,range,caretPos=0;if(window.getSelection)sel=window.getSelection(),sel.rangeCount&&(range=sel.getRangeAt(0),range.commonAncestorContainer.parentNode==editableDiv&&(caretPos=range.endOffset));else if(document.selection&&document.selection.createRange&&(range=document.selection.createRange(),range.parentElement()==editableDiv)){var tempEl=document.createElement("span");editableDiv.insertBefore(tempEl,editableDiv.firstChild);var tempRange=range.duplicate();tempRange.moveToElementText(tempEl),tempRange.setEndPoint("EndToEnd",range),caretPos=tempRange.text.length}return caretPos},insertTextAtCursor:function(text){var sel,range;window.getSelection?(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount&&(range=sel.getRangeAt(0),range.deleteContents(),range.insertNode(document.createTextNode(text)))):document.selection&&document.selection.createRange&&(document.selection.createRange().text=text)},pasteHtmlAtCaret:function(html,node){var sel,range;if(window.getSelection){if(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount){if(range=sel.getRangeAt(0),node&&(range.startContainer.id!=node.id||range.endContainer.id!=node.id||range.startContainer.className!=node.className||range.endContainer.className!=node.className))return!1;range.deleteContents();var el=document.createElement("div");el.innerHTML=html;for(var node,lastNode,frag=document.createDocumentFragment();node=el.firstChild;)lastNode=frag.appendChild(node);if(lastNode==node)return;range.insertNode(frag),lastNode&&(range=range.cloneRange(),range.setStartAfter(lastNode),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(html)},saveSelection:function(){if(window.getSelection){var sel=window.getSelection();if(sel.getRangeAt&&sel.rangeCount)return sel.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restoreSelection:function(range){if(range)if(window.getSelection){var sel=window.getSelection();sel.removeAllRanges(),sel.addRange(range)}else document.selection&&range.select&&range.select()},getSelectionStart:function(){return document.getSelection().getStartElement()},getCaretCharacterOffsetWithin:function(element){var sel,caretOffset=0,doc=element.ownerDocument||element.document,win=doc.defaultView||doc.parentWindow;if("undefined"!=typeof win.getSelection){if(sel=win.getSelection(),sel.rangeCount>0){var range=win.getSelection().getRangeAt(0),preCaretRange=range.cloneRange();preCaretRange.selectNodeContents(element),preCaretRange.setEnd(range.endContainer,range.endOffset),caretOffset=preCaretRange.toString().length}}else if((sel=doc.selection)&&"Control"!=sel.type){var textRange=sel.createRange(),preCaretTextRange=doc.body.createTextRange();preCaretTextRange.moveToElementText(element),preCaretTextRange.setEndPoint("EndToEnd",textRange),caretOffset=preCaretTextRange.text.length}return caretOffset},setCaretPosition:function(element,offset){for(var range=document.createRange(),sel=window.getSelection(),currentNode=null,previousNode=null,i=0;i<element.childNodes.length;i++){for(previousNode=currentNode,currentNode=element.childNodes[i];currentNode.childNodes.length>0;)currentNode=currentNode.childNodes[0];if(currentNode&&null!=previousNode&&(offset-=previousNode.length),offset<=currentNode.length)break}if(null!=currentNode){currentNode.length<offset&&offset--;try{return range.setStart(currentNode,offset),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range),!0}catch(e){}}return!1},getSelectedText:function(withHtml){var html="";if("undefined"!=typeof window.getSelection){var sel=window.getSelection();if(sel.rangeCount){for(var container=document.createElement("div"),i=0,len=sel.rangeCount;i<len;++i)container.appendChild(sel.getRangeAt(i).cloneContents());html=withHtml?container.innerHTML:container.innerText}}else"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(html=withHtml?document.selection.createRange().htmlText:document.selection.createRange().text);return html}},String.prototype.replaceAll=function(search,replacement){var target=this;return target.split(search).join(replacement)},Array.prototype.merge=function(A){if(Array.isArray(A))for(var i=0;i<A.length;i++){var a=A[i];this.indexOf(a)<0&&this.push(a)}else this.indexOf(A)<0&&this.push(A)},Array.prototype.contains=function(obj){for(var i=0;i<this.length;i++)if(this[i]===obj)return!0;return!1},Array.prototype.toggleObject=function(obj){for(var i=0;i<this.length;i++)if(this[i]==obj)return this.splice(i,1),-1;return this.push(obj),1},Array.prototype.remove=function(obj){for(var i=0;i<this.length;i++)this[i]==obj&&this.splice(i,1)},Array.prototype.clear=function(){0!=this.length&&this.splice(0,this.length)},Array.prototype.clone=function(){return this.slice(0)},String.prototype.countChar=function(char){if(0==this.length)return 0;for(var count=0,i=0;i<this.length;i++){var ch=this.charAt(i);ch==char&&count++}return count},Math.isPowerOfTwo=function(number){var n2=number-1;return 0!=number&&0==(number&n2)},Math.rnd=function(min,max){return Math.floor(Math.random()*(max-min+1))+min},Math.previousPowerOfTwo=function(x){return 0==x?0:(x|=x>>1,x|=x>>2,x|=x>>4,x|=x>>8,x|=x>>16,x-(x>>1))};var ColorGenerator={counter:0,value1:137,value2:0,generate:function(from,to){var color=Math.rnd(from,to),rgb=[0,0,0];ColorGenerator.counter=ColorGenerator.counter>2?0:ColorGenerator.counter+1;var left=ColorGenerator.counter>0?ColorGenerator.counter-1:2,right=ColorGenerator.counter<3?ColorGenerator.counter+1:0;rgb[ColorGenerator.counter]=color,rgb[left]=ColorGenerator.value1,rgb[right]=ColorGenerator.value2;var r=rgb[0].toString(16),g=rgb[1].toString(16),b=rgb[2].toString(16);return"0"==r&&(r="00"),"0"==g&&(g="00"),"0"==b&&(b="00"),"#"+r+g+b}},BADomain=function(name){this.table=null,this.expression=null,this.getTree=function(){return this.expression.rootNode}},BAGroup=function(text){this.expression=new BAExpression(text),this.key=BAGroup.getNextGroupIndex(text),this.number=BAGroup.groupIndex-1,this.expression.groupKey=this.key,this.isValid=function(){return this.expression.isValid()},this.getHtml=function(){return this.expression.getHtml()},this.getText=function(){return this.expression.text}};BAGroup.groups=[],BAGroup.groupIndex=1,BAGroup.getNextGroupIndex=function(text){for(var i=0;i<BAGroup.groups.length;i++){var group=BAGroup.groups[i];if(group.text==text)return group.key}return"G"+BAGroup.groupIndex++},BAGroup.get=function(key){var vKey=key.replace(SYMBOL_NEG,"");if(vKey.length<2)return null;for(var i=0;i<BAGroup.groups.length;i++){var group=BAGroup.groups[i];if(vKey==group.key)return group}return null},BAGroup.add=function(group){BAGroup.groups.push(group)},BAGroup.useGroup=function(mainExpr,group){mainExpr.useGroup(group);for(var i=0;i<BAGroup.groups.length;i++){var g=BAGroup.groups[i];g.key!=group.key&&g.expression.useGroup(group)}};var BANode=function(params){this.value=params?params.value:null,this.child1=params?params.child1:null,this.child2=params?params.child2:null,this.parent=params?params.parent:null,this.clipInfo=!!params&&params.clipInfo,this.parent=null,this.group=params?params.group:null,this.isClips=function(){return null!=this.clipInfo},this.isValid=function(){return this.child2&&this.child1},this.isRoot=function(){return null==this.parent},this.findChild=function(value){if(this.value==value)return this;var child=this.child2?this.child2.findChild(value):null;return null!=child?child:this.child1?this.child1.findChild(value):null},this.getHtml=function(){var value=this.value;if(this.isLeaf())value='<span class="expr">'+value+"</span>";else if(!this.isRoot()&&this.isGroup()||this.isRoot()&&this.isGroup()&&!this.child1&&!this.child2)value='<span class="expr group">'+value+"</span>";else{var childA=this.child1&&""!=this.child1.value?this.child1.getHtml():"",childB=this.child2&&""!=this.child2.value?this.child2.getHtml():"",Class="";Class=value==SYMBOL_NEG?"neg":IS_OPERATOR(value)?"op":"expr",value=childA+'<span class="'+Class+'">'+value+"</span>"+childB}return this.isClips()&&(value='<span class="clips">(</span>'+this.clipInfo.rootNode.getHtml()+'<span class="clips">)</span>'),value},this.isGroup=function(){return null!=this.group},this.isLeaf=function(){return!(this.isGroup()||this.child2&&null!=this.child2&&this.child1&&null!=this.child1)},this.getLetters=function(){var letters=[];return""==this.value?letters:(this.isClips()&&this.clipInfo.rootNode?letters.merge(this.clipInfo.rootNode.getLetters()):!this.isGroup()||this.child1||this.child2?this.isLeaf()?letters.merge(this.value):(letters.merge(this.child1.getLetters()),letters.merge(this.child2.getLetters())):letters.merge(this.group.expression.rootNode.getLetters()),letters)},this.getResult=function(param){var result=0;if(!this.isGroup()||this.child2||this.child1)if(this.isClips())result=this.clipInfo.rootNode.getResult(param);else if(IS_OPERATOR(this.value)){var childA=this.child1.getResult(param),childB=this.child2.getResult(param);switch(""==this.child1.value?result=childB:""==this.child2.value&&(result=childA),this.value){case SYMBOL_AND:result=1==childA&&1==childB;break;case SYMBOL_OR:result=1==childA||1==childB;break;case SYMBOL_IMPL:result=1-childA==1||1==childB;break;case SYMBOL_EQUAL:result=childA==childB;break;case SYMBOL_NEG:result=1-result}}else for(var key in param)param.hasOwnProperty(key)&&key==this.value&&(result=Number(param[key]));else result=this.group.expression.rootNode.getResult(param);return result?1:0}},BATable=function(rootNode){this.letters=[],this.groups=BAGroup.groups,this.bits=[],this.isLoading=!1;this.build=function(node){this.isLoading=!0,this.letters.clear(),node&&(this.letters=node.getLetters()),tableIsDirty=!0,this.isLoading=!1},this.build(rootNode);var tableIsDirty=!0;this.updateView=function(){if(tableIsDirty){this.isLoading=!0,this.bits.clear();for(var lettersCount=this.letters.length,max=Math.pow(2,lettersCount),l=0;l<max;l++){for(var bitLine={letters:[],groups:[],clips:[]},lTemp=l,valueObject={},i=lettersCount-1;i>=0;i--){var letter=this.letters[lettersCount-1-i],v=0,vTemp=Math.pow(2,i);lTemp>=vTemp&&(lTemp-=vTemp,v=1),bitLine.letters.push({value:v}),valueObject[letter]=v}bitLine.param=valueObject,bitLine.result={},this.bits.push(bitLine)}tableIsDirty=!1,this.isLoading=!1}}},BAExpression=function(text){var $this=this;this.rootNode=null,this.text="",this.errors=[],this.clips=[];var priorSplit=[SYMBOL_EQUAL,SYMBOL_IMPL,SYMBOL_OR,SYMBOL_AND,SYMBOL_NEG],pushError=function(data){$this.errors.push(data)},clearErrors=function(){$this.errors.length=0},getClipByRaw=function(raw){for(var i=0;i<$this.clips.length;i++){var c=$this.clips[i];if(raw==c.raw)return c}return null},getClips=function(text){for(var re=BAExpression.regex.clips,found=0,count=0;null!==(match=re.exec(text));){if(count++>=99999)return!1;var m=match[0],clip=getClipByRaw(m);if(found++,null==clip){var mInside=m.substr(1,m.length-2),key="["+$this.clips.length+"]";clip={key:key,text:mInside,raw:m,start:match.index,end:re.lastIndex-1},$this.clips.push(clip)}}var output=text;if(found>0){for(var i=0;i<$this.clips.length;i++)clip=$this.clips[i],output=output.replaceAll(clip.raw,clip.key);var clipInfo=getClips(output);output=clipInfo.output}return{input:text,output:output}},tableBuffer=null;this.generateTable=function(){return tableIsDirty&&(tableBuffer=new BATable(this.rootNode),tableIsDirty=!1),tableBuffer};var splitByOperator=function(text){for(var i=0;i<priorSplit.length;i++){var pS=priorSplit[i],index=text.indexOf(pS);if(index>-1){var sideA=text.substring(0,index),sideB=text.substring(index+1,text.length);return{a:sideA,b:sideB,value:pS}}}return{a:null,b:null,value:text}},getClipInfo=function(key){if(key.length<3)return null;for(var i=0;i<$this.clips.length;i++){var clip=$this.clips[i];if(clip.key==key)return clip}return null};this.onTextChanged=function(){},this.buildTree=function(text){if(null==text)return null;var splitInfo=splitByOperator(text),node=new BANode({value:splitInfo.value,child1:this.buildTree(splitInfo.a),child2:this.buildTree(splitInfo.b)});if(node.isLeaf()&&""!=node.value){var group=BAGroup.get(text),clip=getClipInfo(text);clip&&(clip.rootNode=this.buildTree(clip.text)),node.group=group,node.clipInfo=clip}return node.child1&&(node.child1.parent=node),node.child2&&(node.child2.parent=node),node},this.findChild=function(value){return this.rootNode.findChild(value)};var matchError=function(text){var tmpChar=text.charAt(0);tmpChar!=SYMBOL_NEG&&IS_OPERATOR(tmpChar)&&pushError({index:0,value:tmpChar,text:"Syntaxerror: "+tmpChar+" at 0"});var idX=text.length-1;tmpChar=text.charAt(idX),IS_OPERATOR(tmpChar)&&pushError({index:idX,value:tmpChar,text:"Syntaxerror: "+tmpChar+" at "+idX});for(var match,re=BAExpression.regex.error;null!==(match=re.exec(text));){var val=match[0];pushError({index:match.index,value:val,text:"Syntaxerror: "+val+" at "+match.index})}for(var clipStack=[],i=0;i<text.length;i++){var C=text.charAt(i);if("("==C||")"==C)if(0==clipStack.length){if(clipStack.push({"char":C,index:i}),")"==C)break}else{var L=clipStack[0];C==L["char"]?clipStack.push({"char":C,index:i}):clipStack.splice(0,1)}}if(clipStack.length>0){var c=clipStack[0];pushError({index:c.index,value:c["char"],text:"Syntaxerror "})}},hasErrors=function(text){return clearErrors(),matchError(text),$this.errors.length>0},tableIsDirty=!0;this.parse=function(text){if(text=text.trim().replaceAll(" ","").toUpperCase(),this.text=text,!hasErrors(text)){$this.clips.length=0;var clipInfo=getClips(text);this.rootNode=this.buildTree(clipInfo.output),tableIsDirty=!0,this.domain&&this.domain.refreshKV&&this.domain.refreshKV(this),this.onTextChanged(this.text)}},text&&this.parse(text),this.isValid=function(){return 0==$this.errors.length},this.getText=function(){return this.text},this.getHtmlWithError=function(){var error=$this.errors[0],bText=this.text.substr(0,error.index),text=this.text.charAt(error.index),aText=this.text.substr(error.index+1);return(""!=bText?"<span>"+bText+"</span>":"")+(""!=text?'<span class="error" title="'+error.text+'">'+text+"</span>":"")+(""!=aText?"<span>"+aText+"</span>":"")},this.getHtml=function(){return this.isValid()?this.rootNode?this.rootNode.getHtml():"":this.getHtmlWithError()},this.groupFilter=function(group){return this.text.replaceAll(group.getText(),group.key)},this.getResult=function(param){return this.rootNode.getResult(param)},this.useGroup=function(group){var text=this.groupFilter(group);return text!=this.text&&(this.parse(text),this.updateInput(),!0)},this.unuseGroup=function(group){var text=this.text.replaceAll(group.key,group.getText());return text!=this.text&&(this.parse(text),this.updateInput(),!0)},this.updateInput=function(){this.$input&&this.$input.html(this.getHtml())},this.useAllGroups=function(){if(null==this.rootNode||this.rootNode.isGroup())return!1;for(var i=0;i<BAGroup.groups.length;i++){var g=BAGroup.groups[i];BAGroup.useGroup(this,g)}}};BAExpression.regex={clips:/\([0|1|A-Z0-9|∨|∧|¬|⇒|⇔|\[\]]+\)/g,clipname:/([?[1-9]+]?)+/g,error:/[A-Za-z0-9]+\(+|\)([A-Za-z0-9]+|¬)|[0-9][A-Za-z]+|¬+(∨|∧|⇒|⇔)|(∨|∧|⇒|⇔)+(∨|∧|⇒|⇔)+|\(\)|\)\(|(∨|∧|⇒|⇔)+\)+|([A-Za-z]+¬+)/g,syntax:/(¬*([((A-Za-z)(1-9)*)|1|0])(∧|∨)?)*/g},BAExpression.validSyntax=function(text){var forbChar=function(char){return char==SYMBOL_AND||char==SYMBOL_OR||char==SYMBOL_IMPL};return!(forbChar(text.charAt(0))||forbChar(text.charAt(text.length-1)))};var CanvasInterface=Class.extend(function(){this.create=function(){}});CanvasInterface.isTouch=!1,CanvasInterface.use=function(framework){var interfaces={EaselJS:EaselInterface};return new interfaces[framework]};var EaselInterface=CanvasInterface.extend(function(){this.create=function(id){var canvas=document.getElementById(id);if(!canvas||"CANVAS"!=canvas.tagName){var c=document.createElement("CANVAS"),cName=id+"_canvas";c.setAttribute("id",cName),canvas.appendChild(c),canvas=c,id=cName}const labelColor="#333";var stage=new createjs.Stage(id);stage.name="stage",stage.enableMouseOver(20);var colorContainer=new createjs.Container;colorContainer.name="colorContainer",colorContainer.x=colorContainer.y=0;var gridOffset={x:0,y:0},blockContainer=new createjs.Container;blockContainer.name="blockContainer",blockContainer.x=blockContainer.y=0;var hoverContainer=new createjs.Container;hoverContainer.name="hoverContainer",hoverContainer.x=hoverContainer.y=0;var getHoverFullAlpha=function(){return CanvasInterface.isTouch?0:1},hoverBlock=new createjs.Shape;hoverBlock.x=hoverBlock.y=0,hoverBlock.alpha=0,hoverContainer.addChild(hoverBlock),stage.addChild(blockContainer),stage.addChild(colorContainer),stage.addChild(hoverContainer);const HALFSIZE=KVDiagram.SIZE/2,FOURSIZE=KVDiagram.SIZE/4,roundFactor=5;canvas.colorBlock=function(block,color,x,y,width,height){block.graphics.setStrokeStyle(2).beginStroke(color).drawRoundRect(x,y,width-1,height-1,roundFactor).endStroke()};var openDownBlock=function(block,color,x,y,width,height,exclude){var g=block.graphics.setStrokeStyle(2),h=y+height,w=x+width;exclude&&"left"==exclude?g.beginStroke(color).moveTo(w/2-FOURSIZE,y).lineTo(w/2,y).endStroke():(g.beginStroke(color).moveTo(x,h-HALFSIZE).lineTo(x,y+roundFactor).quadraticCurveTo(x,y,x+roundFactor,y).endStroke(),g.beginStroke(color).moveTo(x+roundFactor,y).lineTo(w/2,y).endStroke()),exclude&&"right"==exclude?g.beginStroke(color).moveTo(w/2,y).lineTo(w-HALFSIZE,y).endStroke():(g.beginStroke(color).moveTo(w/2,y).lineTo(w-roundFactor,y).quadraticCurveTo(w,y,w,y+roundFactor).endStroke(),g.beginStroke(color).moveTo(w,y+roundFactor).lineTo(w,h-HALFSIZE).endStroke())},openUpBlock=function(block,color,x,y,width,height,exclude){var g=block.graphics.setStrokeStyle(2),h=y+height,w=x+width;exclude&&"left"==exclude?g.beginStroke(color).moveTo(w/2-FOURSIZE,h).lineTo(w/2,h).endStroke():(g.beginStroke(color).moveTo(x,y+HALFSIZE).lineTo(x,h-roundFactor).quadraticCurveTo(x,h,x+roundFactor,h).endStroke(),g.beginStroke(color).moveTo(x+roundFactor,h).lineTo(w/2,h).endStroke()),exclude&&"right"==exclude?g.beginStroke(color).moveTo(x/2,h).lineTo(w-HALFSIZE,h).endStroke():(g.beginStroke(color).moveTo(w/2,h).lineTo(w-roundFactor,h).quadraticCurveTo(w,h,w,h-roundFactor).endStroke(),g.beginStroke(color).moveTo(w,h-roundFactor).lineTo(w,y+HALFSIZE).endStroke())},openLeftBlock=function(block,color,x,y,width,height){var g=block.graphics.setStrokeStyle(2),s=x+width,h=y+height;g.beginStroke(color).moveTo(x+HALFSIZE,y).lineTo(s-roundFactor,y).quadraticCurveTo(s,y,s,y+roundFactor).endStroke(),g.beginStroke(color).moveTo(s,y+roundFactor).lineTo(s,h).endStroke(),g.beginStroke(color).moveTo(s,h-roundFactor).quadraticCurveTo(s,h,s-=roundFactor,h).endStroke(),g.beginStroke(color).moveTo(s,h).lineTo(x+HALFSIZE,h).endStroke()},openRightBlock=function(block,color,x,y,width,height){var g=block.graphics.setStrokeStyle(2),s=0,h=y+height;g.beginStroke(color).moveTo(x+width-HALFSIZE,y).lineTo(x+roundFactor,y).quadraticCurveTo(x,y,x,s=y+roundFactor).endStroke(),g.beginStroke(color).moveTo(x,s).lineTo(x,s=h-roundFactor).endStroke(),g.beginStroke(color).moveTo(x,s).quadraticCurveTo(x,h,x+roundFactor,h).endStroke(),g.beginStroke(color).moveTo(x+roundFactor,h).lineTo(x+width-HALFSIZE,h).endStroke()};canvas.createColorBlock=function(rect){var shape=new createjs.Shape;return shape.x=rect.x,shape.y=rect.y,rect.open.up?rect.open.left?openUpBlock(shape,rect.block.color,0,0,rect.width,rect.height,"left"):rect.open.right?openUpBlock(shape,rect.block.color,0,0,rect.width,rect.height,"right"):openUpBlock(shape,rect.block.color,0,0,rect.width,rect.height):rect.open.down?rect.open.left?openDownBlock(shape,rect.block.color,0,0,rect.width,rect.height,"left"):rect.open.right?openDownBlock(shape,rect.block.color,0,0,rect.width,rect.height,"right"):openDownBlock(shape,rect.block.color,0,0,rect.width,rect.height):rect.open.left?openLeftBlock(shape,rect.block.color,0,0,rect.width,rect.height):rect.open.right?openRightBlock(shape,rect.block.color,0,0,rect.width,rect.height):canvas.colorBlock(shape,rect.block.color,0,0,rect.width,rect.height),shape};var colored_blocks=[];canvas.clearColoredBlocks=function(){colored_blocks=[],colorContainer.removeAllChildren()},canvas.setOffset=function(offset){gridOffset.x=offset.x,gridOffset.y=offset.y},canvas.getOffset=function(){return gridOffset},canvas.setHoverColor=function(color){canvas.colorBlock(hoverBlock,color,8,8,HALFSIZE,HALFSIZE)},canvas.clearColorContainer=function(){colorContainer.removeAllChildren(),color_index=0};var color_index=0;canvas.addRectsToColorContainer=function(rects){var colorLayer=new createjs.Container;colorLayer.name="colorLayer"+color_index++,colorLayer.x=gridOffset.x,colorLayer.y=gridOffset.y;for(var r=0;r<rects.length;r++){var rect=rects[r],shape=canvas.createColorBlock(rect);colorLayer.addChild(shape)}colorContainer.addChild(colorLayer)};var IBlocks=[];return canvas.getIBlocks=function(){return IBlocks},canvas.add=function(block,readonly){IBlocks.push(block);var label=new createjs.Text(block.value,"20px Arial",labelColor);label.colors={normal:labelColor,error:"red"},label.textAlign="center",label.textBaseline="middle",label.x=block.width/2,label.y=block.height/2;var button=new createjs.Container;if(button.name="block_"+block.x+"_"+block.y,button.x=block.x,button.y=block.y,block.ui={label:label,button:button},block instanceof KVBlock){var bg=new createjs.Shape;bg.overColor="#ddd",bg.outColor="white",bg.graphics.beginFill(bg.outColor).beginStroke("black").drawRect(0,0,block.width,block.height),button.addChild(bg),readonly||(button.addEventListener("click",function(evt){canvas.onBlockClick&&canvas.onBlockClick({event:evt,block:block,label:label,button:button,background:bg,cell:block.cell}),hoverBlock.alpha=0,canvas.refresh()}),button.addEventListener("mouseover",function(evt){hoverBlock.alpha=getHoverFullAlpha(),hoverBlock.x=block.x,hoverBlock.y=block.y,canvas.onBlockHover&&canvas.onBlockHover({event:evt,block:block,label:label,button:button,background:bg,cell:block.cell}),canvas.refresh()}),button.addEventListener("mouseout",function(evt){hoverBlock.alpha=0,canvas.onBlockOut&&canvas.onBlockOut({event:evt,block:block,label:label,button:button,background:bg,cell:block.cell}),canvas.refresh()})),block.ui.bg=bg}button.addChild(label),blockContainer.addChild(button)},canvas.getBlockContainer=function(){return blockContainer},canvas.getColorContainer=function(){return colorContainer},canvas.getStage=function(){return stage},canvas.copyIntoCanvas=function(cv){cv.clearChildren(),cv.clearColorContainer(),cv.setOffset(canvas.getOffset());for(var iBlocks=canvas.getIBlocks(),i=0;i<iBlocks.length;i++){var iBlock=iBlocks[i];cv.add(iBlock,!0)}cv.setSize(stage.canvas.width,stage.canvas.height)},canvas.clearChildren=function(){blockContainer.removeAllChildren(),IBlocks=[]},canvas.onBlockHover=function(block){},canvas.onBlockClick=function(block){},canvas.onBlockOut=function(block){},canvas.setSize=function(width,height){stage.canvas.width=width,stage.canvas.height=height},canvas.refresh=function(force){stage.update()},canvas}}),ColorPathMap=function(){this.diagram=null,this.canvas=null,this.layers=[],this.onChangedLayer=function(layer){},this.config=function(canvas,diagram){this.diagram=diagram,this.canvas=canvas},this.getLayer=function(color){for(var i=0;i<this.layers.length;i++){var layer=this.layers[i];if(layer.color==color)return layer}return null},this.clear=function(){this.layers.length=0},this.removeLayer=function(layer){var index=this.layers.indexOf(layer);this.layers.splice(index,1),this.canvas.clearColorContainer();var blocks=this.analyze();this.diagram.colorBlocks(blocks)},this.analyze=function(cell,color){if(cell&&color){var colorLayer=this.getLayer(color);null==colorLayer&&(colorLayer=new ColorPathLayer(color),colorLayer.diagram=this.diagram,this.layers.push(colorLayer),this.onChangedLayer(colorLayer));var length=colorLayer.toggleCell(cell,this.diagram.getWidth());if(0==length){var index=this.layers.indexOf(colorLayer);this.layers.splice(index,1),this.onChangedLayer(colorLayer)}}for(var blocks=[],i=0;i<this.layers.length;i++)blocks=blocks.concat(blocks,this.layers[i].blocks);return blocks}},ColorPathLayer=function(color){var $this=this;this.color=color,this.cellField=[],this.cells=[],this.diagram=null,this.resultState=0,this.expression=new BAExpression,this.expression.onTextChanged=function(){$this.resultState=0},this.blocks=[],this.value=-1;var searchAlgo=new KVReflectingSearch(this.cells),exprBuffer=null;this.getBlocksExpr=function(asString){if(!isDirty)return asString?exprBuffer.text:exprBuffer;for(var expr="",eConnect=0==this.value?KVDiagram.Conjunction:KVDiagram.Disjunction,i=0;i<this.blocks.length;i++){var block=this.blocks[i],e=block.getExpr(),eStr=e.text;this.blocks.length>1&&IS_OPERATOR(e.rootNode.value)&&(eStr="("+eStr+")"),expr=eConnect(expr,eStr)}return asString?expr:(isDirty=!1,exprBuffer=new BAExpression(expr))};var isDirty=!0;this.checkExpression=function(){var blocksExpr=this.getBlocksExpr(),inputExpr=this.expression,compBlocks=new KVExprCompare(blocksExpr),compInput=new KVExprCompare(inputExpr);return this.resultState=compInput.equals(compBlocks)?1:-1,this.resultState},this.toggleCell=function(cell,width){if(this.value==-1||this.value==cell.value){var pos={col:parseInt(cell.n%width),row:parseInt(cell.n/width)},row=this.cellField[pos.row];row||(row=this.cellField[pos.row]=new KVRow),row.getCell(pos.col)?row.removeCell(pos.col):row.setCell(pos.col,cell),isDirty=!0,this.cells.toggleObject(cell),0==this.cells.length?this.value=-1:1==this.cells.length&&(this.value=this.cells[0].value),this.blocks=searchAlgo.search(this.cells,this.value);for(var i=0;i<this.blocks.length;i++)this.blocks[i].color=this.color;return this.cells.length}}},KVCell=function(value,Vars){this.value=value||0,this.assignedVars=Vars||{},this.n=-1,this.visited=!1;var varLength=Vars?Object.keys(Vars).length:0;this.getVarLength=function(){return varLength},this.addVar=function(char,value){this.assignedVars[char]=value,varLength++},this.equals=function(col){return this.n==col.n},this.getVarAtIndex=function(index){var i=0;for(var property in this.assignedVars){if(index==i)return{key:property,value:this.assignedVars[property]};i++}return null},this.getVarAtIndexStr=function(index){var Var=this.getVarAtIndex(index);return(0==Var.value?SYMBOL_NEG:"")+Var.key},this.clone=function(){var vars={};for(var property in this.assignedVars)vars[property]=this.assignedVars[property];return new KVCell(this.value,vars)}};KVCell.compare=function(a,b){return a.n<b.n?-1:a.n>b.n?1:0};var KVRow=function(){this.cells=[],this.addCell=function(col){this.cells.push(col)},this.appendCols=function(A){this.cells=this.cells.concat(A)},this.setCell=function(index,cell){this.cells[index]=cell},this.removeCell=function(index){this.cells[index]=null},this.getCell=function(index){return this.cells[index]},this.getLength=function(){return this.cells.length},this.clone=function(){for(var row=new KVRow,i=0;i<this.cells.length;i++)row.addCell(this.cells[i].clone());return row}},IBlock=Class.extend(function(){this.x=0,this.y=0,this.width=0,this.height=0,this.value=0,this.constructor=function(x,y,width,height,value){this.x=x,this.y=y,this.width=width,this.height=height,this.value=value},this.getValue=function(){return this.value},this.setValue=function(val){this.value=val},this.getX=function(){return this.x},this.setX=function(x){this.x=x},this.getY=function(){return this.y},this.setY=function(y){this.y=y},this.getWidth=function(){return this.width},this.setWidth=function(width){this.width=width},this.getHeight=function(){return this.height},this.setHeight=function(height){this.height=height}}),KVBlock=IBlock.extend(function(){this.cell=null,this.constructor=function(x,y,width,height,cell){this.cell=cell,this["super"](x,y,width,height,cell.value)},this.setValue=function(val){this.cell.value=val},this.getValue=function(){return this.cell.value}}),KVDiagram=function(expression,canvas){var V=expression.rootNode.getLetters();this.field=[],this.cells=[];var width=0;const size=KVDiagram.SIZE;this.getWidth=function(){return width},this.getHeight=function(){return this.field.length},this.getRow=function(index){return this.field[index]};var reflectV=function(A){for(var reflField=[],r=A.length-1;r>=0;r--){var row=A[r];reflField.push(row.clone())}return A.concat(reflField)},reflectH=function(A){for(var r=0;r<A.length;r++){for(var mirror=[],row=A[r],c=row.getLength()-1;c>=0;c--){var col=row.getCell(c);mirror.push(col.clone())}row.appendCols(mirror)}return A};this.reflectHorizontal=function(Var){if(this.field.length<1){var newRow=new KVRow;newRow.addCell(new KVCell(0)),newRow.addCell(new KVCell(0)),this.field.push(newRow)}else this.field=reflectH(this.field);width=this.field[0].getLength();for(var half=width/2,i=0;i<this.field.length;i++)for(var row=this.field[i],j=0;j<half;j++){var colA=row.getCell(j),colB=row.getCell(half+j);colA.addVar(Var,1),colB.addVar(Var,0)}},this.reflectVertical=function(Var){if(this.field.length<2){var row=this.field[0].clone();this.field.push(row)}else this.field=reflectV(this.field);for(var half=this.getHeight()/2,i=0;i<half;i++)for(var rowA=this.field[i],rowB=this.field[half+i],j=0;j<rowA.getLength();j++)rowA.getCell(j).addVar(Var,1),rowB.getCell(j).addVar(Var,0)},this.calcView=function(){var h=Math.ceil(V.length/2),w=V.length-h,width=w*size+this.getWidth()*size+size,height=h*size+this.getHeight()*size+size;return{width:width,height:height}},this.createNetwork=function(){for(var w=this.getWidth(),w2=w-1,h=this.getHeight(),L=w*h,L2=L-1,n=0;n<this.cells.length;n++){var cell=this.cells[n];cell.n=n;var nMw=n%w,r=nMw==w2?n-w2:n+1;cell.right=this.cells[r];var l=0==nMw?n+w2:n-1;cell.left=this.cells[l];var b=n<=L2-w?n+w:n-L+w;cell.bottom=this.cells[b];var t=n<w?L-(w-n):n-w;cell.top=this.cells[t]}},this.generateBlocks=function(canvas){var h=Math.ceil(V.length/2),w=V.length-h,gridOffset={x:size*w,y:size*h};canvas.setOffset(gridOffset),canvas.clearChildren(),this.cells=[];for(var r=0;r<this.getHeight();r++){for(var block,aVar,row=this.getRow(r),firstcol=row.getCell(0),rI=1,offX=1;rI<firstcol.getVarLength();rI+=2,offX++)aVar=firstcol.getVarAtIndexStr(rI),block=new IBlock(gridOffset.x+offX*-size,gridOffset.y+r*size,size,size,aVar),canvas.add(block);for(var c=0;c<this.getWidth();c++){var col=row.getCell(c);if(0==r)for(var cI=0,offY=1;cI<col.getVarLength();cI+=2,offY++)aVar=col.getVarAtIndexStr(cI),block=new IBlock(gridOffset.x+c*size,gridOffset.y+offY*-size,size,size,aVar),canvas.add(block);col.value=expression.getResult(col.assignedVars),block=new KVBlock(gridOffset.x+c*size,gridOffset.y+r*size,size,size,col),this.cells.push(col),canvas.add(block)}}canvas.refresh(!0)};var allBlocks=[];this.minimize=function(){var searchAlgo=new KVReflectingSearch,info={
dnf:{expr:null,blocks:null},knf:{expr:null,blocks:null}};info.dnf.blocks=searchAlgo.search(this.cells,1),info.knf.blocks=searchAlgo.search(this.cells,0),allBlocks=info.dnf.blocks.concat(info.knf.blocks);var i,block,minExpr,expr="",dnf=[];for(i=0;i<info.dnf.blocks.length;i++)block=info.dnf.blocks[i],minExpr=block.getExpr(!0),dnf.push(minExpr);for(dnf.sort(),i=0;i<dnf.length;i++){var d=dnf[i];dnf.length>1&&(d.indexOf(SYMBOL_OR)>-1||d.indexOf(SYMBOL_AND)>-1)&&(d="("+d+")"),expr=KVDiagram.Disjunction(expr,d)}info.dnf.expr=new BAExpression(expr),expr="";var knf=[];for(i=0;i<info.knf.blocks.length;i++)block=info.knf.blocks[i],minExpr=block.getExpr(!0),knf.push(minExpr);for(knf.sort(),i=0;i<knf.length;i++){var k=knf[i];knf.length>1&&(k.indexOf(SYMBOL_OR)>-1||k.indexOf(SYMBOL_AND)>-1)&&(k="("+k+")"),expr=KVDiagram.Conjunction(expr,k)}return info.knf.expr=new BAExpression(expr),info},this.colorBlocks=function(blocks){Array.isArray(blocks)||(blocks=[blocks]);for(var i=0;i<blocks.length;i++){var block=blocks[i];block.color||(block.color=ColorGenerator.generate(60,ColorGenerator.value1));var rects=block.createColorRects(this.getWidth(),this.getHeight());canvas.addRectsToColorContainer(rects)}canvas.refresh()},this.init=function(V){for(var i=0;i<V.length;i++)i%2==0?this.reflectHorizontal(V[i]):this.reflectVertical(V[i]);this.generateBlocks(canvas),this.createNetwork()},this.init(V)};KVDiagram.SIZE=32,KVDiagram.Disjunction=function(a,b){return void 0==a||""==a?b:void 0==b||""==b?a:a+SYMBOL_OR+b},KVDiagram.Conjunction=function(a,b){return void 0==a||""==a?b:void 0==b||""==b?a:a+SYMBOL_AND+b};var BAKV=function(params){var $this=this;this.diagram=null,this.colorMap=new ColorPathMap,this.canvas=null,this.solutionCanvas=null;var selectColor=null;this.expression=params.expression,this.setCanvas=function(target,solutionTarget){var canvasInterface=CanvasInterface.use("EaselJS");this.canvas=canvasInterface.create(target),this.solutionCanvas=canvasInterface.create(solutionTarget),this.canvas.onBlockClick=function(parm){if(null!=selectColor){var blocks=$this.colorMap.analyze(parm.cell,selectColor);$this.canvas.clearColorContainer(),$this.diagram.colorBlocks(blocks)}}},this.setCanvas(params.target,params.solutionTarget),this.setSelectColor=function(color){selectColor=color,this.canvas.setHoverColor(color)},this.setExpression=function(expr){this.expression=expr},this.resizeCanvas=function(){var view=this.diagram.calcView();this.canvas.setSize(view.width,view.height)},this.generateKV=function(){this.diagram=new KVDiagram(this.expression,this.canvas),this.resizeCanvas(),this.colorMap.clear(),this.colorMap.config(this.canvas,this.diagram),this.canvas.clearColorContainer(),this.canvas.refresh()};var minimizeInfo=null;this.minimize=function(){return minimizeInfo=this.diagram.minimize()},this.showSolution=function(){this.canvas.copyIntoCanvas(this.solutionCanvas);var i,j,blockA,blockB,isInList,blocks=[];for(i=0;i<this.colorMap.layers.length;i++)blocks=blocks.concat(this.colorMap.layers[i].blocks);for(i=0;i<minimizeInfo.dnf.blocks.length;i++){for(blockA=minimizeInfo.dnf.blocks[i],isInList=!1,j=0;j<blocks.length;j++)if(blockB=blocks[j],blockA.equals(blockB)){isInList=!0;break}isInList||blocks.push(blockA)}for(i=0;i<minimizeInfo.knf.blocks.length;i++){for(blockA=minimizeInfo.knf.blocks[i],isInList=!1,j=0;j<blocks.length;j++)if(blockB=blocks[j],blockA.equals(blockB)){isInList=!0;break}isInList||blocks.push(blockA)}for(i=0;i<blocks.length;i++){var block=blocks[i];block.color||(block.color=ColorGenerator.generate(60,ColorGenerator.value1));var rects=block.createColorRects(this.diagram.getWidth(),this.diagram.getHeight());this.solutionCanvas.addRectsToColorContainer(rects)}this.solutionCanvas.refresh()},this.colorMinimized=function(type){null!=minimizeInfo&&this.diagram.colorBlocks(minimizeInfo[type].blocks)},this.refresh=function(){this.canvas.refresh()}},KVExprCompare=function(expression){this.expression=expression,this.setExpression=function(expr){this.expression=expr},this.getText=function(){return this.expression.text},this.equals=function(compare){if(!compare)return!1;if(compare.getText()==this.getText())return!0;var compTable=compare.expression.generateTable();compTable.updateView();var thisTable=this.expression.generateTable();if(thisTable.updateView(),compTable.bits.length!=thisTable.bits.length)return!1;for(var bits=compTable.bits.length>thisTable.bits.length?compTable.bits:thisTable.bits,i=0;i<bits.length;i++){var bitLine=bits[i],resultA=this.expression.getResult(bitLine.param),resultB=compare.expression.getResult(bitLine.param);if(resultA!=resultB)return!1}return!0}};KVExprCompare.getClips=function(text){for(var re=BAExpression.regex.clips,count=0,result=[];null!==(match=re.exec(text));){if(count++>=99999)return!1;var m=match[0];result.push(m)}return result},KVExprCompare.isKNF=function(text){var clips=KVExprCompare.getClips(text);if(0==clips.length)return!0;for(var i=0;i<clips.length;i++){var clip=clips[i];if(clip.indexOf(SYMBOL_AND)>-1)return!1;text=text.replace(clip,"K")}return text.indexOf(SYMBOL_OR)<=-1},KVExprCompare.isDNF=function(text){var clips=KVExprCompare.getClips(text);if(0==clips.length)return!0;for(var i=0;i<clips.length;i++){var clip=clips[i];if(clip.indexOf(SYMBOL_OR)>-1)return!1;text=text.replace(clip,"K")}return text.indexOf(SYMBOL_AND)<=-1};var KVReflectingBlock=Class.extend(function(){var $this=this,width=1;this.cells=[],this.allowedCells=null,this.constructor=function(cell,allowedCells){this.cells=[[cell]],allowedCells&&(this.allowedCells=allowedCells)},this.getWidth=function(){return width},this.setWidth=function(w){width=w},this.getHeight=function(){return this.cells.length},this.cellList=[],this.createCellList=function(){if(this.cellList.length>0)return this.cellList.clone();for(var y=0;y<this.getHeight();y++)for(var x=0;x<this.getWidth();x++){var cell=this.cells[y][x];this.cellList.push(cell)}return this.cellList.clone()},this.equals=function(block){if(this.getWidth()!=block.getWidth()||this.getHeight()!=block.getHeight())return!1;var listA=this.createCellList(),listB=block.createCellList();if(listA.length!=listB.length)return!1;for(var i=0;i<listB.length;i++)for(var objB=listB[i],j=0;j<listA.length;j++){var objA=listA[j];if(objA.equals(objB)){listA.splice(j,1);break}}return 0==listA.length},this.createColorRects=function(fieldWidth,fieldHeight){var createKVReflectingBlockRect=function(x,y,width,height){return new KVReflectingBlockRect(x,y,width,height,$this)},correctionValues={x:8,y:8,width:-16,height:-16},correctionRect=function(rect){rect.x+=correctionValues.x,rect.y+=correctionValues.y,rect.width+=correctionValues.width,rect.height+=correctionValues.height},openRects=function(rects,fieldWidth,fieldHeight){var rect=rects[0],xDistance=fieldWidth-(rect.x+rect.width),yDistance=fieldHeight-(rect.y+rect.height);xDistance<0&&yDistance<0?openRectAll(rect,rects,xDistance,yDistance):xDistance<0?openRectRightLeft(rect,rects,xDistance):yDistance<0&&openRectUpDown(rect,rects,yDistance),correctionRect(rect)},openRectAll=function(rect,rects,xDistance,yDistance){rect.open.right=rect.open.down=!0;var newRectUpLeft=createKVReflectingBlockRect(xDistance,yDistance,rect.width,rect.height);newRectUpLeft.open.left=newRectUpLeft.open.up=!0,correctionRect(newRectUpLeft),rects.push(newRectUpLeft);var newRectUpRight=createKVReflectingBlockRect(rect.x,yDistance,rect.width,rect.height);newRectUpRight.open.right=newRectUpRight.open.up=!0,correctionRect(newRectUpRight),rects.push(newRectUpRight);var newRectDownLeft=createKVReflectingBlockRect(xDistance,rect.y,rect.width,rect.height);newRectDownLeft.open.left=newRectDownLeft.open.down=!0,correctionRect(newRectDownLeft),rects.push(newRectDownLeft)},openRectRightLeft=function(rect,rects,xDistance){rect.open.right=!0;var newRect=createKVReflectingBlockRect(xDistance,rect.y,rect.width,rect.height);newRect.open.left=!0,correctionRect(newRect),rects.push(newRect)},openRectUpDown=function(rect,rects,yDistance){rect.open.down=!0;var newRect=createKVReflectingBlockRect(rect.x,yDistance,rect.width,rect.height);newRect.open.up=!0,correctionRect(newRect),rects.push(newRect)},rects=[],cell=$this.cells[0][0],x=parseInt(cell.n%fieldWidth),y=parseInt(cell.n/fieldWidth),rect=createKVReflectingBlockRect(x*KVDiagram.SIZE,y*KVDiagram.SIZE);return rects.push(rect),rect.width=$this.getWidth()*KVDiagram.SIZE,rect.height=$this.getHeight()*KVDiagram.SIZE,openRects(rects,fieldWidth*KVDiagram.SIZE,fieldHeight*KVDiagram.SIZE),rects},this.clone=function(){var block=new KVReflectingBlock(cell);return block.setWidth(this.getWidth()),block.cells=this.cells,block};var minVars={},calcMin=function(key,value){var minEntry=minVars[key];minEntry!=-1&&(0==minEntry||1==minEntry?minEntry!=value&&(minVars[key]=-1):minVars[key]=value)};this.getExpr=function(asString){if(minVars.length>0)return minVars;for(var key,value,r=0;r<this.getHeight();r++)for(var row=this.cells[r],c=0;c<this.getWidth();c++){var cell=row[c],vars=cell.assignedVars;for(key in vars)calcMin(key,vars[key])}var newMinVarsKeys=[];for(key in minVars)value=minVars[key],value<0||newMinVarsKeys.push(key);newMinVarsKeys.sort();for(var expr="",eConnect=1==cell.value?KVDiagram.Conjunction:KVDiagram.Disjunction,i=0;i<newMinVarsKeys.length;i++){key=newMinVarsKeys[i],value=minVars[key];var keyValue=key;0==cell.value&&1==value&&(keyValue=SYMBOL_NEG+key),1==cell.value&&0==value&&(keyValue=SYMBOL_NEG+key),expr=eConnect(expr,keyValue)}return asString?expr:new BAExpression(expr)},this.concatHorizontal=function(A,B){for(var C=[],maxHeight=Math.min(A.length,B.length),r=0;r<maxHeight;r++)C.push(A[r].concat(B[r]));this.cells=C,width=this.cells[0].length,minVars={}},this.concatVertical=function(A,B){this.cells=A.concat(B),minVars={}},this.areReflectable=function(cellA,cellB){return cellA.n!=cellB.n&&cellA.value==cellB.value},this.reflect=function(){return!!this.reflectRight(!1)||(!!this.reflectDown(!1)||(!!this.reflectLeft(!1)||(!!this.reflectUp(!1)||(!!this.reflectRight(!0)||(!!this.reflectDown(!0)||(!!this.reflectLeft(!0)||!!this.reflectUp(!0)))))))},this.reflectRight=function(throughWall){for(var collection=[],r=0;r<this.getHeight();r++){for(var row=this.cells[r],first=row[0],last=row[row.length-1],next=last,collectionRow=[],c=0;c<this.getWidth();c++){if(next=next.right,next.n<last.n&&!throughWall)return!1;if(next.equals(first))return!1;if(!this.areReflectable(last,next))return!1;if(this.allowedCells&&!this.allowedCells.contains(next))return!1;collectionRow.push(next)}collection.push(collectionRow)}return this.concatHorizontal(this.cells,collection),!0},this.reflectLeft=function(throughWall){for(var collection=[],r=0;r<this.getHeight();r++){for(var row=this.cells[r],first=row[0],last=row[row.length-1],next=first,collectionRow=[],c=0;c<this.getWidth();c++){if(next=next.left,next.n>first.n&&!throughWall)return!1;if(next.equals(last))return!1;if(!this.areReflectable(first,next))return!1;if(this.allowedCells&&!this.allowedCells.contains(next))return!1;collectionRow.unshift(next)}collection.push(collectionRow)}return this.concatHorizontal(collection,this.cells),!0},this.reflectDown=function(throughWall){for(var lastRow=this.cells[this.cells.length-1],firstRow=this.cells[0],collection=[],c=0;c<this.getWidth();c++)for(var first=firstRow[c],last=lastRow[c],next=last,r=0;r<this.getHeight();r++){if(next=next.bottom,next.n<last.n&&!throughWall)return!1;if(next.equals(first))return!1;if(!this.areReflectable(last,next))return!1;if(this.allowedCells&&!this.allowedCells.contains(next))return!1;var collectionRow;collection.length<=r?collection.push(collectionRow=[]):collectionRow=collection[r],collectionRow.push(next)}return this.concatVertical(this.cells,collection),!0},this.reflectUp=function(throughWall){for(var lastRow=this.cells[this.cells.length-1],firstRow=this.cells[0],collection=[],c=0;c<this.getWidth();c++)for(var first=firstRow[c],last=lastRow[c],next=first,r=0;r<this.getHeight();r++){if(next=next.top,next.n>first.n&&!throughWall)return!1;if(next.equals(last))return!1;if(!this.areReflectable(first,next))return!1;if(this.allowedCells&&!this.allowedCells.contains(next))return!1;var collectionRow;collection.length<=r?collection.push(collectionRow=[]):collectionRow=collection[r],collectionRow.push(next)}for(var newCollection=[],i=collection.length-1;i>=0;i--)newCollection.push(collection[i]);return this.concatVertical(newCollection,this.cells),!0}}),KVSearchAlgorithm=Class.extend(function(){this.constructor=function(){},this.search=function(){},this.init=function(){},this.expand=function(){}}),KVReflectingSearch=KVSearchAlgorithm.extend(function(){this.cellField=null,this.constructor=function(cellField){cellField&&(this.cellField=cellField)},this.init=function(cells){for(var i=0;i<cells.length;i++){var cell=cells[i];cell&&(cell.visited=!1)}},this.search=function(cells,value){var blocks=[];this.init(cells);for(var i=0;i<cells.length;i++){var cell=cells[i];if(!cell.visited&&cell.value==value){var block=new KVReflectingBlock(cell,this.cellField);this.expand(block),blocks.push(block)}}return blocks},this.expand=function(block){for(;this.reflect(block););for(var r=0;r<block.getHeight();r++)for(var row=block.cells[r],c=0;c<block.getWidth();c++){var cell=row[c];cell.visited=!0}},this.reflect=function(block){return block.reflect()}}),_Rectangle_=Class.extend(function(){this.x=0,this.y=0,this.width=0,this.height=0,this.constructor=function(x,y,width,height){this.x=x,this.y=y,this.width=width,this.height=height}}),KVReflectingBlockRectOpen=function(){this.right=!1,this.left=!1,this.up=!1,this.down=!1},KVReflectingBlockRect=_Rectangle_.extend(function(){this.block=null,this.open=new KVReflectingBlockRectOpen,this.constructor=function(x,y,width,height,block){this.block=block,this["super"](x,y,width,height)}}),BACircuit=function(params){};angular.module("boolean-algebra",["ngRoute","pascalprecht.translate","ngSanitize"]).config(function($routeProvider,$locationProvider){var href=angular.element("head base").attr("href");$routeProvider.when("/",{templateUrl:href+"view/boolalg.html",controller:"BACtrl"}),$routeProvider.otherwise({redirectTo:"/"}),$locationProvider.html5Mode(!0)}).config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"translations/lang-",suffix:".json"}),$translateProvider.useSanitizeValueStrategy("escape"),$translateProvider.preferredLanguage("de_DE")}]);