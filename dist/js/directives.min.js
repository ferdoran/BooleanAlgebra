!function(){var app=angular.module("boolean-algebra");app.directive("dropmenu",function($timeout,$sce){return{restrict:"A",link:function($scope,$element,$attr){var $ul=$element.find("ul"),$li=$ul.children("li"),$firstLi=$li.siblings("[selected]");0==$firstLi.length&&($firstLi=$li.first());var $preview,change=$scope[$attr.dropmenuChange]||function(key){console.log("You've chosen "+key+". Please use dropdown-change attribute to invoke a function.")};$timeout(function(){$element.prepend('<div class="preview"><span class="content">'+$sce.trustAsHtml($firstLi.html())+'</span><span class="glyphicon glyphicon-triangle-bottom"></span></div>'),$preview=$element.find(".preview"),$element.css({width:$firstLi.outerWidth()+50+"px"})},500);var close=function(){$element.removeClass("open")};$li.on("click",function(e){var $thisLi=angular.element(this);change($thisLi.attr("value")),close(),$timeout(function(){$preview.find(".content").html($thisLi.html())},100),e.stopPropagation()}),$element.on("click",function(e){$element.toggleClass("open"),e.stopPropagation(),e.preventDefault()}).on("blur",close)}}})}(),function(){var app=angular.module("boolean-algebra");app.directive("onFinishRender",function($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){scope.$emit(attr.onFinishRender)})}}})}(),function(){var app=angular.module("boolean-algebra");app.directive("contenteditable",function($timeout){return{restrict:"A",scope:{expression:"=bindExpression",layer:"="},link:function($scope,$element,$attr){var to,expression=$scope.expression||$scope.layer.expression,isForbiddenKey=function(e){return e.keyCode==KEY_SPACE||e.keyCode==KEY_COMMA||e.keyCode==KEY_DOT||e.keyCode==KEY_LINE||e.keyCode==KEY_SHARP||e.keyCode==KEY_PLUS||"-"==e.key||"*"==e.key||"+"==e.key||"/"==e.key},refreshTable=function(){if(!expression.domain||!expression.domain.tableRefresh)return!1;var domain=expression.domain;domain.tableRefresh()};$element.on("keydown",function(e){if(isForbiddenKey(e))return e.preventDefault(),!1}).on("keyup change",function(e){if("keyup"==e.type){if(e.keyCode==KEY_CONTROL||e.keyCode==KEY_SPACE)return e.preventDefault(),!1;if(e.keyCode==KEY_LEFT||e.keyCode==KEY_RIGHT||e.keyCode==KEY_DOWN||e.keyCode==KEY_UP)return!0}$timeout.cancel(to),to=$timeout(function(){var text=$element.text();expression.parse(text);var position=DomUtils.getCaretCharacterOffsetWithin($element.get(0));$element.html(expression.getHtml()),DomUtils.setCaretPosition($element.get(0),position),refreshTable()},50)})}}}),app.directive("boolExpr",function($parse,$sce,$timeout){return{restrict:"E",replace:!0,templateUrl:"directives/boolExpr/boolExpr.html",scope:{group:"=",layer:"=",expression:"=bindExpression"},link:function($scope,$element,$attr){var $input=$element.find(".input"),updateExpressions=function(newGroup){domain&&(BAGroup.useGroup(domain.expression,newGroup),domain.resizeTable&&domain.resizeTable())};$scope.layer?$scope.expression=$scope.layer.expression:$scope.group?$scope.expression=$scope.group.expression:$scope.expression||($scope.expression=new BAExpression($attr.boolValue||"")),$input.html($scope.expression.getHtml()),$scope.isColorBox="#"==$attr.boolSymbol.charAt(0),$scope.symbol=$attr.boolSymbol,$scope.symbolSmall=$attr.boolSymbolSmall,$scope.isColorBox&&$timeout(function(){var color=$attr.boolSymbol,$colorBox=$element.find(".colorBox");$colorBox.css("background-color",color)}),$scope.expression.$input=$input;var domain=app.domains[$attr.boolDomain];domain&&!$scope.group&&(domain.expression=$scope.expression),$scope.expression.domain=domain,$scope.group&&updateExpressions($scope.group),$scope.addChar=function(char){$input.focus(),DomUtils.pasteHtmlAtCaret(char),$input.change()},$scope.clearText=function(){$scope.expression.parse(""),$scope.expression.updateInput()},$scope.groupButton=function(){if(domain){var selText=DomUtils.getSelectedText();if(0!=selText.length){if(!BAExpression.validSyntax(selText))return void alert("Wrong Syntax "+selText);var newGroup=new BAGroup(selText);BAGroup.add(newGroup),updateExpressions(newGroup),domain.resizeTable&&domain.resizeTable()}}},$scope.removeGroup=function(){if(domain){for(var group=$scope.group,index=-1,i=0;i<BAGroup.groups.length;i++){var g=BAGroup.groups[i];g.key!=group.key?g.expression.unuseGroup(group):index=i}domain.expression.unuseGroup(group),index>-1&&BAGroup.groups.splice(index,1),domain.resizeTable&&domain.resizeTable()}},$scope.removeColorLayer=function(layer){$scope.$emit("removeColorLayer",layer)}}}})}(),function(){var app=angular.module("boolean-algebra");app.directive("boolInput",function($parse,$sce){return{restrict:"E",replace:!0,scope:!0,templateUrl:"directives/boolInput/boolInput.html",link:function($scope,$element,$attr){$scope.symbol=$attr.boolSymbol,$scope.symbolSmall=$attr.boolSymbolSmall;var EXPR=$attr.boolExpr||"";$scope.expression=new BAExpression(EXPR),$scope.groups=BAGroup.groups,$scope.expression.useAllGroups();var domain=app.domains[$attr.boolDomain];domain&&(domain.expression=$scope.expression),$scope.boolDomain=$attr.boolDomain}}})}(),function(){var app=angular.module("boolean-algebra");app.directive("boolTableSelect",function($parse,$sce){return{restrict:"E",replace:!0,templateUrl:"directives/boolTable/boolTableSelect.html",scope:{param:"=bindParam",expression:"=bindExpression"},link:function($scope,$element,$attr){$scope.isCorrect=null,$scope.faClass="",$scope.value="",$scope.isDirty=!1;var locateClass=function(){null==$scope.isCorrect?$scope.faClass="no-info":1==$scope.isCorrect?$scope.faClass="fa-check":$scope.faClass="fa-close"};locateClass();var checkResult=function(){if(!$scope.isDirty)return!1;if(""==$scope.value)$scope.isCorrect=null;else{var value=Number($scope.value),result=$scope.expression.getResult($scope.param);$scope.isCorrect=value==result}};$scope.$on("check-result",function(){checkResult(),locateClass()}),$element.on("change",function(){$scope.isDirty=!0})}}})}(),function(){var app=angular.module("boolean-algebra");app.directive("boolTable",function($parse,$sce,$timeout){return{restrict:"E",replace:!0,scope:!0,templateUrl:"directives/boolTable/boolTable.html",link:function($scope,$element,$attr){var $table=$element.find("table"),$fixedTables=($table[0],angular.element(".fixed_headers")),domain=app.domains[$attr.boolDomain];domain||alert("Es wurde keine Domain gefunden!"),$scope.expression=domain.expression,$scope.checkResult=function(){$scope.$broadcast("check-result")},domain.resizeTableTO=null,domain.resizeTable=function(delay){delay||(delay=10),domain.resizeTableTO=$timeout(function(){$fixedTables.each(function(){var $t=angular.element(this),$tBody=$t.find("tbody"),$ths=$t.find("thead th"),$tds=$tBody.find("td"),$trs=$tBody.find("tr"),widths=[];$ths.each(function(index){widths[index]=angular.element(this).outerWidth(!0)}),$tds.each(function(index){var $td=angular.element(this);$td.css({width:widths[index]+"px"})});var maxHeight=0;$trs.each(function(){var $tr=angular.element(this);maxHeight+=$tr.outerHeight(!0)}),$t.find(".slimScrollDiv").css({"max-height":maxHeight+"px"})})},delay)},$scope.$on("ngRepeatFinished",function(ngRepeatFinishedEvent){domain.resizeTable()}),$fixedTables.each(function(){var $fH=angular.element(this);$fH.find("tbody").slimScroll({height:"191px",alwaysVisible:!1})}),domain.tableRefresh=function(){$scope.table?$scope.table.build(domain.expression.rootNode):($scope.table=domain.expression.generateTable(),domain.table=$scope.table),$scope.table.updateView(),domain.resizeTable()},domain.tableRefresh(),angular.element(window).resize(function(){domain.resizeTable()})}}})}(),function(){var app=angular.module("boolean-algebra"),_kvCounter=0;app.directive("boolKv",function($parse,$timeout){return{restrict:"E",replace:!0,scope:!0,templateUrl:"directives/boolKV/boolKV.html",link:function($scope,$element,$attr){var cv=$element.find("#kvCanvasContainer");cv[0].id="kvCanvasContainer"+_kvCounter++;var domain=app.domains[$attr.boolDomain],expr=domain&&!$attr.boolExpr?domain.expression:new BAExpression($attr.boolExpr);CanvasInterface.isTouch=angular.element("html").hasClass("touch");var $colors,kv=new BAKV({target:cv[0].id,expression:expr}),initColors=function(){$colors=$element.find(".kvColor"),$colors.each(function(){var $this=angular.element(this);if($this.hasClass("active")){var startColor=$this.data("color");kv.setSelectColor(startColor)}$this.css("background-color",$this.data("color"))}).click(function(){var $el=angular.element(this),color=$el.data("color");"reset"==color?kv.setSelectColor(null):kv.setSelectColor(color),$colors.removeClass("active"),$el.addClass("active")})};initColors(),$scope.checkResult=function(){$scope.$broadcast("checkLayerResults")},$scope.help=function(){},domain&&(domain.refreshKV=function(_expr){domain.toKV&&$timeout.cancel(domain.toKV),domain.toKV=$timeout(function(){kv.setExpression(expr=_expr),kv.generateKV()},50)}),kv.generateKV(),$scope.kv=kv}}})}(),function(){var app=angular.module("boolean-algebra");app.directive("boolKvBlockInput",function($timeout){return{restrict:"E",replace:!0,scope:{layer:"=bindLayer"},templateUrl:"directives/boolKVBlockInput/boolKVBlockInput.html",link:function($scope,$element,$attr){$scope.layer.expression;$scope.$on("checkLayerResults",function(){$scope.layer.checkExpression()})}}})}(),function(){var app=angular.module("boolean-algebra");app.directive("boolKvBlockMin",function($timeout){return{restrict:"E",replace:!0,scope:{kv:"=bindKv"},templateUrl:"directives/boolKVBlockMin/boolKVBlockMin.html",link:function($scope,$element,$attr){$scope.knf=new BAExpression,$scope.dnf=new BAExpression,$scope.knfResultState=0,$scope.dnfResultState=0,$scope.knf.onTextChanged=function(){$scope.knfResultState=0},$scope.dnf.onTextChanged=function(){$scope.dnfResultState=0};var colorMap=$scope.kv.colorMap;$scope.customLayers=colorMap.layers,colorMap.onChangedLayer=function(){$timeout(function(){$scope.$apply()})};var compareKnfDnf=function(info){var compareKnfB=new KVExprCompare(info.knf.expr),compareDnfB=new KVExprCompare(info.dnf.expr),compareDnfA=new KVExprCompare($scope.dnf),compareKnfA=new KVExprCompare($scope.knf);$scope.knfResultState=compareKnfA.equals(compareKnfB)?1:-1,$scope.dnfResultState=compareDnfA.equals(compareDnfB)?1:-1};$scope.$on("checkLayerResults",function(){var minimizeInfo=$scope.kv.minimize();compareKnfDnf(minimizeInfo)}),$scope.$on("removeColorLayer",function(layer){colorMap.removeLayer(layer)})}}})}();