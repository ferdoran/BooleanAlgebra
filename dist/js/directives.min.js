var app=angular.module("boolean-algebra");app.directive("contenteditable",function($timeout){return{restrict:"A",scope:{expression:"=bindExpression"},link:function($scope,$element,$attr){var expression=$scope.expression,isForbiddenKey=function(e){return e.keyCode==KEY_SPACE||e.keyCode==KEY_COMMA||e.keyCode==KEY_DOT},refreshTable=function(){if(!expression.domain||!expression.domain.tableRefresh)return!1;var domain=expression.domain;$timeout.cancel(domain.table.buildTO),domain.table.buildTO=$timeout(function(){domain.tableRefresh()},500)};$element.on("keydown",function(e){if(isForbiddenKey(e))return e.preventDefault(),!1}).on("keyup change",function(e){if("keyup"==e.type){if(e.keyCode==KEY_CONTROL||e.keyCode==KEY_SPACE)return e.preventDefault(),!1;if(e.keyCode==KEY_LEFT||e.keyCode==KEY_RIGHT||e.keyCode==KEY_DOWN||e.keyCode==KEY_UP)return!0}var text=$element.text();expression.parse(text);var position=DomUtils.getCaretCharacterOffsetWithin($element.get(0));$element.html(expression.getHtml()),DomUtils.setCaretPosition($element.get(0),position),refreshTable()})}}}),app.directive("boolExpr",function($parse,$sce){return{restrict:"E",replace:!0,templateUrl:"directives/boolExpr/boolExpr.html",scope:{group:"=",expression:"=bindExpression"},link:function($scope,$element,$attr){var $input=$element.find(".input"),updateExpressions=function(newGroup){BAGroup.useGroup(domain.expression,newGroup)};$scope.group?$scope.expression=$scope.group.expression:$scope.expression||($scope.expression=new BAExpression($attr.boolValue||"")),$input.html($scope.expression.getHtml()),$scope.symbol=$attr.boolSymbol,$scope.symbolSmall=$attr.boolSymbolSmall,$scope.expression.$input=$input;var domain=app.domains[$attr.boolDomain];domain&&!$scope.group&&(domain.expression=$scope.expression),$scope.expression.domain=domain,$scope.group&&updateExpressions($scope.group),$scope.addChar=function(char){DomUtils.pasteHtmlAtCaret(char),$input.change()},$scope.clearText=function(){$scope.expression.parse(""),$scope.expression.updateInput()},$scope.groupButton=function(){var selText=DomUtils.getSelectedText();if(0!=selText.length){if(!BAExpression.validSyntax(selText))return void alert("Wrong Syntax "+selText);var newGroup=new BAGroup(selText);BAGroup.add(newGroup),updateExpressions(newGroup)}},$scope.removeGroup=function(){for(var group=$scope.group,index=-1,i=0;i<BAGroup.groups.length;i++){var g=BAGroup.groups[i];g.key!=group.key?g.expression.unuseGroup(group):index=i}domain.expression.unuseGroup(group),index>-1&&BAGroup.groups.splice(index,1)}}}});var app=angular.module("boolean-algebra");app.directive("boolInput",function($parse,$sce){return{restrict:"E",replace:!0,scope:!0,templateUrl:"directives/boolInput/boolInput.html",link:function($scope,$element,$attr){var testExpr="¬A∧B∨C∧A∧B";$scope.expression=new BAExpression(testExpr),$scope.groups=BAGroup.groups,BAGroup.add(new BAGroup("A"+SYMBOL_AND+"B")),BAGroup.add(new BAGroup("B"+SYMBOL_OR+"C")),$scope.expression.useAllGroups();var testExpr=function(expr,letters){console.log("TEST: "+expr.text);for(var max=Math.pow(2,letters.length),l=0;l<max;l++){for(var bitLine={},lTemp=l,i=letters.length-1;i>=0;i--){var v=0,vTemp=Math.pow(2,i);lTemp>=vTemp&&(lTemp-=vTemp,v=1);var letter=letters[letters.length-1-i];bitLine[letter]=v}console.log(bitLine),console.log(expr.getResult(bitLine))}},domain=app.domains[$attr.boolDomain];domain&&(domain.expression=$scope.expression),$scope.boolDomain=$attr.boolDomain}}});var app=angular.module("boolean-algebra");app.directive("boolTableSelect",function($parse,$sce){return{restrict:"E",replace:!0,templateUrl:"directives/boolTable/boolTableSelect.html",scope:{param:"=bindParam",expression:"=bindExpression"},link:function($scope,$element,$attr){$scope.isCorrect=null,$scope.faClass="",$scope.value="",$scope.isDirty=!1;var locateClass=function(){null==$scope.isCorrect?$scope.faClass="no-info":1==$scope.isCorrect?$scope.faClass="fa-check":$scope.faClass="fa-close"};locateClass();var checkResult=function(){if(!$scope.isDirty)return!1;if(""==$scope.value)$scope.isCorrect=null;else{var value=Number($scope.value);console.log("=====EXPRESSION===="),console.log($scope.expression);var result=$scope.expression.getResult($scope.param);console.log($scope.param),console.log("Result: "+result+", Value: "+value),$scope.isCorrect=value==result}};$scope.$on("check-result",function(){checkResult(),locateClass()}),$element.on("change",function(){$scope.isDirty=!0})}}});var app=angular.module("boolean-algebra");app.directive("boolTable",function($parse,$sce){return{restrict:"E",replace:!0,scope:!0,templateUrl:"directives/boolTable/boolTable.html",link:function($scope,$element,$attr){var $table=$element.find("table"),domain=($table[0],app.domains[$attr.boolDomain]);domain||alert("Es wurde keine Domain gefunden!"),$scope.expression=domain.expression,$scope.checkResult=function(){$scope.$broadcast("check-result")},domain.tableRefresh=function(){$scope.table?$scope.table.build(domain.expression.rootNode):($scope.table=new BATable(domain.expression.rootNode),domain.table=$scope.table),$scope.table.updateView()},domain.tableRefresh()}}});