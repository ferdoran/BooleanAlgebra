var app=angular.module("boolean-algebra");app.directive("dropmenu",function($timeout,$sce){return{restrict:"A",link:function($scope,$element,$attr){var $ul=$element.find("ul"),$li=$ul.children("li"),$firstLi=$li.siblings("[selected]");0==$firstLi.length&&($firstLi=$li.first());var $preview,change=$scope[$attr.dropmenuChange]||function(key){console.log("You've chosen "+key+". Please use dropdown-change attribute to invoke a function.")};$timeout(function(){$element.prepend('<div class="preview"><span class="content">'+$sce.trustAsHtml($firstLi.html())+'</span><span class="glyphicon glyphicon-triangle-bottom"></span></div>'),$preview=$element.find(".preview"),$element.css({width:$firstLi.outerWidth()+50+"px"})},500);var close=function(){$element.removeClass("open")};$li.on("click",function(e){var $thisLi=angular.element(this);change($thisLi.attr("value")),close(),$timeout(function(){$preview.find(".content").html($thisLi.html())},100),e.stopPropagation()}),$element.on("click",function(e){$element.toggleClass("open"),e.stopPropagation(),e.preventDefault()}).on("blur",close)}}});var app=angular.module("boolean-algebra");app.directive("onFinishRender",function($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){scope.$emit(attr.onFinishRender)})}}});var app=angular.module("boolean-algebra");app.directive("contenteditable",function($timeout){return{restrict:"A",scope:{expression:"=bindExpression"},link:function($scope,$element,$attr){var to,expression=$scope.expression,isForbiddenKey=function(e){return e.keyCode==KEY_SPACE||e.keyCode==KEY_COMMA||e.keyCode==KEY_DOT||e.keyCode==KEY_LINE||e.keyCode==KEY_SHARP||e.keyCode==KEY_PLUS||"-"==e.key||"*"==e.key||"+"==e.key||"/"==e.key},refreshTable=function(){if(!expression.domain||!expression.domain.tableRefresh)return!1;var domain=expression.domain;domain.tableRefresh()};$element.on("keydown",function(e){if(isForbiddenKey(e))return e.preventDefault(),!1}).on("keyup change",function(e){if("keyup"==e.type){if(e.keyCode==KEY_CONTROL||e.keyCode==KEY_SPACE)return e.preventDefault(),!1;if(e.keyCode==KEY_LEFT||e.keyCode==KEY_RIGHT||e.keyCode==KEY_DOWN||e.keyCode==KEY_UP)return!0}$timeout.cancel(to),to=$timeout(function(){var text=$element.text();expression.parse(text);var position=DomUtils.getCaretCharacterOffsetWithin($element.get(0));$element.html(expression.getHtml()),DomUtils.setCaretPosition($element.get(0),position),0!=text.length&&refreshTable()},50)})}}}),app.directive("boolExpr",function($parse,$sce){return{restrict:"E",replace:!0,templateUrl:"directives/boolExpr/boolExpr.html",scope:{group:"=",expression:"=bindExpression"},link:function($scope,$element,$attr){var $input=$element.find(".input"),updateExpressions=function(newGroup){BAGroup.useGroup(domain.expression,newGroup),domain.resizeTable&&domain.resizeTable()};$scope.group?$scope.expression=$scope.group.expression:$scope.expression||($scope.expression=new BAExpression($attr.boolValue||"")),$input.html($scope.expression.getHtml()),$scope.symbol=$attr.boolSymbol,$scope.symbolSmall=$attr.boolSymbolSmall,$scope.expression.$input=$input;var domain=app.domains[$attr.boolDomain];domain&&!$scope.group&&(domain.expression=$scope.expression),$scope.expression.domain=domain,$scope.group&&updateExpressions($scope.group),$scope.addChar=function(char){$input.focus(),DomUtils.pasteHtmlAtCaret(char),$input.change()},$scope.clearText=function(){$scope.expression.parse(""),$scope.expression.updateInput()},$scope.groupButton=function(){var selText=DomUtils.getSelectedText();if(0!=selText.length){if(!BAExpression.validSyntax(selText))return void alert("Wrong Syntax "+selText);var newGroup=new BAGroup(selText);BAGroup.add(newGroup),updateExpressions(newGroup),domain.resizeTable&&domain.resizeTable()}},$scope.removeGroup=function(){for(var group=$scope.group,index=-1,i=0;i<BAGroup.groups.length;i++){var g=BAGroup.groups[i];g.key!=group.key?g.expression.unuseGroup(group):index=i}domain.expression.unuseGroup(group),index>-1&&BAGroup.groups.splice(index,1),domain.resizeTable&&domain.resizeTable()}}}});var app=angular.module("boolean-algebra");app.directive("boolInput",function($parse,$sce){return{restrict:"E",replace:!0,scope:!0,templateUrl:"directives/boolInput/boolInput.html",link:function($scope,$element,$attr){var testExpr="¬A∧B∨C∧A∧B";testExpr="A⇔B∨C",testExpr="",$scope.symbol=$attr.boolSymbol,$scope.symbolSmall=$attr.boolSymbolSmall,$scope.expression=new BAExpression(testExpr),$scope.groups=BAGroup.groups,$scope.expression.useAllGroups();var testExpr=function(expr,letters){console.log("TEST: "+expr.text);for(var max=Math.pow(2,letters.length),l=0;l<max;l++){for(var bitLine={},lTemp=l,i=letters.length-1;i>=0;i--){var v=0,vTemp=Math.pow(2,i);lTemp>=vTemp&&(lTemp-=vTemp,v=1);var letter=letters[letters.length-1-i];bitLine[letter]=v}console.log(bitLine),console.log(expr.getResult(bitLine))}},domain=app.domains[$attr.boolDomain];domain&&(domain.expression=$scope.expression),$scope.boolDomain=$attr.boolDomain}}});var app=angular.module("boolean-algebra");app.directive("boolTableSelect",function($parse,$sce){return{restrict:"E",replace:!0,templateUrl:"directives/boolTable/boolTableSelect.html",scope:{param:"=bindParam",expression:"=bindExpression"},link:function($scope,$element,$attr){$scope.isCorrect=null,$scope.faClass="",$scope.value="",$scope.isDirty=!1;var locateClass=function(){null==$scope.isCorrect?$scope.faClass="no-info":1==$scope.isCorrect?$scope.faClass="fa-check":$scope.faClass="fa-close"};locateClass();var checkResult=function(){if(!$scope.isDirty)return!1;if(""==$scope.value)$scope.isCorrect=null;else{var value=Number($scope.value),result=$scope.expression.getResult($scope.param);$scope.isCorrect=value==result}};$scope.$on("check-result",function(){checkResult(),locateClass()}),$element.on("change",function(){$scope.isDirty=!0})}}});var app=angular.module("boolean-algebra");app.directive("boolTable",function($parse,$sce,$timeout){return{restrict:"E",replace:!0,scope:!0,templateUrl:"directives/boolTable/boolTable.html",link:function($scope,$element,$attr){var $table=$element.find("table"),$fixedTables=($table[0],angular.element(".fixed_headers")),domain=app.domains[$attr.boolDomain];domain||alert("Es wurde keine Domain gefunden!"),$scope.expression=domain.expression,$scope.checkResult=function(){$scope.$broadcast("check-result")},domain.resizeTableTO=null,domain.resizeTable=function(delay){delay||(delay=10),domain.resizeTableTO=$timeout(function(){$fixedTables.each(function(){var $t=angular.element(this),$tBody=$t.find("tbody"),$ths=$t.find("thead th"),$tds=$tBody.find("td"),$trs=$tBody.find("tr"),widths=[];$ths.each(function(index){widths[index]=angular.element(this).outerWidth(!0)}),$tds.each(function(index){var $td=angular.element(this);$td.css({width:widths[index]+"px"})});var maxHeight=0;$trs.each(function(){var $tr=angular.element(this);maxHeight+=$tr.outerHeight(!0)}),$t.find(".slimScrollDiv").css({"max-height":maxHeight+"px"})})},delay)},$scope.$on("ngRepeatFinished",function(ngRepeatFinishedEvent){domain.resizeTable()}),$fixedTables.each(function(){var $fH=angular.element(this);$fH.find("tbody").slimScroll({height:"191px",alwaysVisible:!1})}),domain.tableRefresh=function(){$scope.table?$scope.table.build(domain.expression.rootNode):($scope.table=new BATable(domain.expression.rootNode),domain.table=$scope.table),$scope.table.updateView(),domain.resizeTable()},domain.tableRefresh(),angular.element(window).resize(function(){domain.resizeTable()})}}});var app=angular.module("boolean-algebra");app.directive("boolKv",function($parse,$timeout,$sce){return{restrict:"E",replace:!0,scope:!0,templateUrl:"directives/boolKV/boolKV.html",link:function($scope,$element,$attr){var kv=new BAKV({target:"kvCanvasContainer",expr:new BAExpression($attr.boolExpr)}),initColors=function(){var $colors=$element.find(".kvColor");$colors.each(function(){var $this=angular.element(this);$this.css("background-color",$this.data("color"))}).click(function(){var $el=angular.element(this),color=$el.data("color");"reset"==color?kv.setSelectColor(null):kv.setSelectColor(color),$colors.removeClass("active"),$el.addClass("active")})};initColors(),$scope.checkResult=function(){kv.checkResult()},kv.generateKV()}}});